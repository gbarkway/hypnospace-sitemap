version: '3.4'

services:
  pageserv-db:
    image: hs-pageserv-db
    build:
      context: page-serv/db
    
  pageserv:
    image: hs-pageserv
    build:
      context: page-serv
      target: production
    depends_on: 
     - pageserv-db
    environment:
      NODE_ENV: production
      MONGO_HOST: mongodb://pageserv-db/hypnospace
    ports:
      - 3000:3000

  captureserv:
    image: hs-captureserv
    build:
      context: capture-serv
      target: production
    environment:
      NODE_ENV: production
    ports:
      - 3001:3000

  web:
    image: hs-web
    profiles:
    - frontend
    build:
      context: web 
      args:
        - DOT_ENV=.env.development
    depends_on:
      - pageserv
      - captureserv 
    ports:
      - 5000:5000
